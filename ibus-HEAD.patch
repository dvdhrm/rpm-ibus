From a3f47e6509f19c6f11fca0328d63e973daec48ab Mon Sep 17 00:00:00 2001
From: Julien Humbert <julroy67@gmail.com>
Date: Wed, 2 Oct 2013 10:45:32 +0900
Subject: [PATCH] Add french layout variant oss to simple engine

Review URL: https://codereview.appspot.com/14115044
Patch from Julien Humbert <julroy67@gmail.com>.
---
 engine/simple.xml.in | 82 ++++++++++++++++++++++++++++++----------------------
 1 file changed, 47 insertions(+), 35 deletions(-)

diff --git a/engine/simple.xml.in b/engine/simple.xml.in
index fbca5ce..3b16820 100644
--- a/engine/simple.xml.in
+++ b/engine/simple.xml.in
@@ -236,41 +236,53 @@
                         <icon>ibus-keyboard</icon>
 			<rank>99</rank>
 		</engine>
-		<engine>
-			<name>xkb:fr::fra</name>
-			<language>fra</language>
-			<license>GPL</license>
-			<author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
-			<layout>fr</layout>
-			<longname>French</longname>
-			<description>French</description>
-                        <icon>ibus-keyboard</icon>
-			<rank>99</rank>
-		</engine>
-		<engine>
-			<name>xkb:fr:bepo:fra</name>
-			<language>fra</language>
-			<license>GPL</license>
-			<author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
-			<layout>fr</layout>
-			<layout_variant>bepo</layout_variant>
-			<longname>French (Bepo, ergonomic, Dvorak way)</longname>
-			<description>French (Bepo, ergonomic, Dvorak way)</description>
-                        <icon>ibus-keyboard</icon>
-			<rank>1</rank>
-		</engine>
-		<engine>
-			<name>xkb:fr:dvorak:fra</name>
-			<language>fra</language>
-			<license>GPL</license>
-			<author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
-			<layout>fr</layout>
-			<layout_variant>dvorak</layout_variant>
-			<longname>French (Dvorak)</longname>
-			<description>French (Dvorak)</description>
-                        <icon>ibus-keyboard</icon>
-			<rank>99</rank>
-		</engine>
+                <engine>
+                        <name>xkb:fr::fra</name>
+                        <language>fra</language>
+                        <license>GPL</license>
+                        <author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
+                        <layout>fr</layout>
+                        <longname>French</longname>
+                        <description>French</description>
+                        <icon>ibus-keyboard</icon>
+                        <rank>99</rank>
+                </engine>
+                <engine>
+                        <name>xkb:fr:oss:fra</name>
+                        <language>fra</language>
+                        <license>GPL</license>
+                        <author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
+                        <layout>fr</layout>
+                        <layout_variant>oss</layout_variant>
+                        <longname>French (alternative)</longname>
+                        <description>French (alternative)</description>
+                        <icon>ibus-keyboard</icon>
+                        <rank>99</rank>
+                </engine>
+                <engine>
+                        <name>xkb:fr:bepo:fra</name>
+                        <language>fra</language>
+                        <license>GPL</license>
+                        <author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
+                        <layout>fr</layout>
+                        <layout_variant>bepo</layout_variant>
+                        <longname>French (Bepo, ergonomic, Dvorak way)</longname>
+                        <description>French (Bepo, ergonomic, Dvorak way)</description>
+                        <icon>ibus-keyboard</icon>
+                        <rank>99</rank>
+                </engine>
+                <engine>
+                        <name>xkb:fr:dvorak:fra</name>
+                        <language>fra</language>
+                        <license>GPL</license>
+                        <author>Peng Huang &lt;shawn.p.huang@gmail.com&gt;</author>
+                        <layout>fr</layout>
+                        <layout_variant>dvorak</layout_variant>
+                        <longname>French (Dvorak)</longname>
+                        <description>French (Dvorak)</description>
+                        <icon>ibus-keyboard</icon>
+                        <rank>1</rank>
+                </engine>
 		<engine>
 			<name>xkb:de::ger</name>
 			<language>ger</language>
-- 
1.8.0

From b8f36164d9b405d95bdcb76e38daca6c531e7da5 Mon Sep 17 00:00:00 2001
From: fujiwarat <takao.fujiwara1@gmail.com>
Date: Wed, 2 Oct 2013 10:55:09 +0900
Subject: [PATCH] Implement lookup-table-orientation in ibus-ui-gtk3.

BUG=RH#1012781
TEST=ui/gtk3/ibus-ui-gtk3

Review URL: https://codereview.appspot.com/14198043
---
 ui/gtk3/panel.vala | 19 ++++++++++++++++++-
 1 file changed, 18 insertions(+), 1 deletion(-)

diff --git a/ui/gtk3/panel.vala b/ui/gtk3/panel.vala
index 82b9ee5..5903e05 100644
--- a/ui/gtk3/panel.vala
+++ b/ui/gtk3/panel.vala
@@ -148,6 +148,10 @@ class Panel : IBus.PanelService {
         m_settings_panel.changed["show-icon-on-systray"].connect((key) => {
                 set_show_icon_on_systray();
         });
+
+        m_settings_panel.changed["lookup-table-orientation"].connect((key) => {
+                set_lookup_table_orientation();
+        });
     }
 
     private void keybinding_manager_bind(KeybindingManager keybinding_manager,
@@ -285,7 +289,7 @@ class Panel : IBus.PanelService {
         m_switcher_delay_time =
                 m_settings_general.get_int("switcher-delay-time");
 
-        if (m_switcher_delay_time >= 0) {
+        if (m_switcher != null && m_switcher_delay_time >= 0) {
             m_switcher.set_popup_delay_time((uint) m_switcher_delay_time);
         }
     }
@@ -312,10 +316,22 @@ class Panel : IBus.PanelService {
     }
 
     private void set_show_icon_on_systray() {
+        if (m_status_icon == null)
+            return;
+
         m_status_icon.set_visible(
                 m_settings_panel.get_boolean("show-icon-on-systray"));
     }
 
+    private void set_lookup_table_orientation() {
+        if (m_candidate_panel == null)
+            return;
+
+        m_candidate_panel.set_vertical(
+                m_settings_panel.get_int("lookup-table-orientation")
+                == IBus.Orientation.VERTICAL);
+    }
+
     private int compare_versions(string version1, string version2) {
         string[] version1_list = version1.split(".");
         string[] version2_list = version2.split(".");
@@ -411,6 +427,7 @@ class Panel : IBus.PanelService {
         set_embed_preedit_text();
         set_custom_font();
         set_show_icon_on_systray();
+        set_lookup_table_orientation();
 
         set_version();
     }
-- 
1.8.0

From 9596aea2e2df4cd3ac9b795ad9f354723cf83317 Mon Sep 17 00:00:00 2001
From: fujiwarat <takao.fujiwara1@gmail.com>
Date: Wed, 2 Oct 2013 10:58:36 +0900
Subject: [PATCH] Always save the content-type cache for gnome-shell
 password.

GDBusProxy updates the cache immediatelly with the first call only
and has to save the next call in the cache by manual.

BUG=RH#1013948
TEST=password on gnome-shell 3.10.

Review URL: https://codereview.appspot.com/14196043
---
 bus/engineproxy.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/bus/engineproxy.c b/bus/engineproxy.c
index 19c2861..efd9586 100644
--- a/bus/engineproxy.c
+++ b/bus/engineproxy.c
@@ -1159,6 +1159,11 @@ bus_engine_proxy_set_content_type (BusEngineProxy *engine,
                            NULL,
                            NULL,
                            NULL);
+
+        /* Need to update the cache by manual since there is a timing issue. */
+        g_dbus_proxy_set_cached_property ((GDBusProxy *) engine,
+                                          "ContentType",
+                                          content_type);
     }
 
     if (cached_content_type != NULL)
-- 
1.8.0

